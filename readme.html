<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>readme</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="tools/style.css" />
</head>
<body>
<h1
id="librvg-c-library-for-random-variate-generation-with-formal-guarantees">librvg:
C Library for Random Variate Generation with Formal Guarantees</h1>
<p>librvg is an open-source C library for generating random variables.
It released under the Apache-2.0 License.</p>
<p>The methods implemented in librvg are described in the following
publication.</p>
<blockquote>
<p>Feras A. Saad and Wonyeol Lee. 2025. Random Variate Generation with
Formal Guarantees. Proc. ACM Program. Lang. 9, PLDI, Article 152 (June
2025), 25 pages. <a
href="https://doi.org/10.1145/3729251">https://doi.org/10.1145/3729251</a></p>
</blockquote>
<p>For the latest version, please visit <a
href="https://github.com/probsys/librvg">https://github.com/probsys/librvg</a></p>
<h2 id="overview">Overview</h2>
<p>The purpose of librvg is to generate random variates from a given
probability distribution. This probability distribution is specified in
terms of a numerical implementation of its <a
href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">cumulative
distribution function</a> (CDF), and optionally in terms of a separate
numerical implementation of its <a
href="https://en.wikipedia.org/wiki/Survival_function">survival
function</a> (SF).</p>
<p>Given a CDF specification as a C function, librvg automatically
synthesizes a function for generating random variates whose probability
distribution is guaranteed to exactly match that of the CDF. This
generator is also guaranteed to be entropy optimal, in the sense that it
consumes the least possible amount of random bits (on average) to
produce a random bits.</p>
<h2 id="programming-with-librvg">Programming with librvg</h2>
<p>Detailed descriptions of the librvg API can be found in <a
href="api.html">api.html</a>.</p>
<p>The following is a brief synopsis of how to get started with the main
tasks supported by the library.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;gsl/gsl_rng.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;rvg/generate.h&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Prepare the random number generator.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>gsl_rng <span class="op">*</span> rng <span class="op">=</span> gsl_rng_alloc<span class="op">(</span>gsl_rng_default<span class="op">);</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> flip_state prng <span class="op">=</span> make_flip_state<span class="op">(</span>rng<span class="op">);</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Implement a custom continuous distribution, F(x) = x^2 over [0,1].</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> cdf_x2<span class="op">(</span><span class="dt">double</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>      <span class="op">(</span>x <span class="op">!=</span> x<span class="op">)</span>        <span class="op">{</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span>       <span class="co">// nan</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>signbit<span class="op">(</span>x<span class="op">))</span>    <span class="op">{</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span>       <span class="co">// &lt;= -0.0</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span><span class="dv">1</span> <span class="op">&lt;=</span> x<span class="op">)</span>        <span class="op">{</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span>       <span class="co">// &gt;= 1</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>                    <span class="op">{</span> <span class="cf">return</span> x<span class="op">*</span>x<span class="op">;</span> <span class="op">}</span>     <span class="co">// x^2 over [0,1]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw a random variate from cdf_x2.</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sample <span class="op">=</span> generate_opt<span class="op">(</span>cdf_x2<span class="op">,</span> <span class="op">&amp;</span>prng<span class="op">);</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;The sample is: </span><span class="sc">%f\n</span><span class="st">&quot;</span><span class="op">,</span> sample<span class="op">);</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute some quantiles of cdf_x2.</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> median <span class="op">=</span> quantile<span class="op">(</span>cdf_x2<span class="op">,</span> <span class="dv">0</span><span class="er">.5</span><span class="op">);</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> quantile_25 <span class="op">=</span> quantile<span class="op">(</span>cdf_x2<span class="op">,</span> <span class="dv">0</span><span class="er">.25</span><span class="op">);</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> quantile_75 <span class="op">=</span> quantile<span class="op">(</span>cdf_x2<span class="op">,</span> <span class="dv">0</span><span class="er">.75</span><span class="op">);</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;The quantiles are: </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%f\n</span><span class="st">&quot;</span><span class="op">,</span> quantile_25<span class="op">,</span> median<span class="op">,</span> quantile_75<span class="op">);</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Free the random number generator.</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>gsl_rng_free<span class="op">(</span>rng<span class="op">);</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The primary function provided by librvg is <code>generate_opt</code>,
which takes as input a CDF implementation and a prng, and returns as
output an exact random variate drawn from that CDF.</p>
<p>A CDF F takes as input a double x and returns a float. It is valid
if:</p>
<ol type="1">
<li>For all x, F(x) is a float in the unit interval [0, 1].</li>
<li>F(x) = 1, whenever x is NaN (i.e., if x != x).</li>
<li>F is monotonic, i.e., if x' &lt; x then F(x') &lt;= F(x).</li>
</ol>
<p>A CDF can be manually implemented as in the above example, or
imported from the <a
href="https://www.gnu.org/software/gsl/doc/html/randist.html">GNU
Scientific Library</a> (GSL), whose CDF functions are named
<code>gsl_cdf_[dist]_P</code>. To use a GSL CDF in librvg, refer to
examples/main.c.</p>
<p>Given a CDF, librvg also provides an exact implementation of the
corresponding <a
href="https://en.wikipedia.org/wiki/Quantile_function">quantile
function</a> (QF), using <code>quantile</code> as shown in the above
example. The quantile takes as input a CDF F and a float q in [0,1], and
returns min{ x | q &lt;= F(x) }. In words, it is the smallest number x'
such that q &lt;= Pr(X &lt;= x').</p>
<h2 id="installation">Installation</h2>
<p>This software is tested on Ubuntu 24.04. Other Linux distributions
are also expected to work with minor modifications to the names of the
dependencies. An alternative approach to installation is by using
Docker, as described in the next section "Running via Docker".</p>
<ul>
<li><p>Step 1: Install C dependencies:</p>
<pre><code>$ sudo apt install build-essential libgsl-dev libgmp-dev</code></pre></li>
<li><p>Step 2: Build the library:</p>
<pre><code>$ make</code></pre>
<p>The files are installed in</p>
<ul>
<li><code>build/lib/librvg.a</code> (static library)</li>
<li><code>build/include/*.h</code> (header files)</li>
</ul></li>
<li><p>Step 3: Run the examples</p>
<pre><code>$ cd examples/
$ make
$ ./main.out
$ ./readme.out</code></pre>
<p>To write new programs that use librvg.a, refer to examples/Makefile
and follow the same build process.</p></li>
</ul>
<h2 id="running-experiments">Running Experiments</h2>
<p>The experiments/ directory contains programs that produce Table 1,
Table 2, and Figure 8 of [SL25]. Running the plotting code requires
<code>python3</code> to be available in the path, with the pandas,
numpy, and matplotlib libraries installed. The experiments take around
5-10 minutes each.</p>
<ul>
<li><p>Table 1</p>
<pre><code>$ cd experiments/
$ make table1</code></pre>
<p>The output is <code>experiments/results.rate/table_1.txt</code></p>
<p>These results shows the bits/variate, variates/sec for random variate
generation using three baselines (GSL, CBS, OPT) on 24 probability
distributions.</p></li>
<li><p>Table 2</p>
<pre><code>$ cd experiments/
$ make table2</code></pre>
<p>The outputs are the .png files in
<code>experiments/results.bounds</code></p>
<p>These results show the output random of random variates using four
generation methods (GSL, CDF, SF, DDF) for 13 probability distributions.
Each row in Table 2 corresponds to a specific png file. In each png
file, the runtimes are shown under the labels on the y-axis and the
output ranges are shown on the x-axis.</p></li>
<li><p>Figure 8</p>
<pre><code>$ cd experiments/
$ make figure8</code></pre>
<p>The output is <code>experiments/results.rate/figure_8.png</code></p>
<p>These results show the ratios of bits/variate and variate/sec using
the basic and extended-accuracy variants of two methods (CBS,
OPT).</p></li>
</ul>
<h2 id="running-via-docker">Running via Docker</h2>
<p>Installing librvg and running the experiments can also be executed in
a virtual Docker container, by using the Dockerfile.</p>
<p>To build the container, first install Docker for your platform using
the instructions at <a
href="https://docs.docker.com/get-started/get-docker/">https://docs.docker.com/get-started/get-docker/</a>.</p>
<p>Step 1. Build the image and container.</p>
<pre><code>$ docker build -f Dockerfile -t librvg .        # build image (~20 mins)
$ docker run -dit --name librvg librvg:latest   # create container</code></pre>
<p>Step 2. Extract the experiment results to the local filesytem.</p>
<pre><code>$ docker cp librvg:/librvg librvg-build         # extract to ./librvg-build</code></pre>
<p>Step 3. (Optional) Launch an interactive terminal in the Docker
container.</p>
<pre><code>$ docker start librvg
$ docker attach librvg</code></pre>
</body>
</html>
